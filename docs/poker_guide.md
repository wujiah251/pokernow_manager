# 德州扑克对局日志分析指南

本文档介绍德州扑克对局日志的分析方法，用于理解玩家行为模式和游戏统计数据。

## 1. 德州扑克基本规则

### 1.1 游戏流程

德州扑克采用公共牌形式，每个牌局分为以下阶段：

| 阶段 | 英文 | 说明 | 公共牌数量 |
|------|------|------|------------|
| 翻牌前 | Pre-flop | 发给每位玩家2张底牌 | 0 |
| 翻牌 | Flop | 发出3张公共牌 | 3 |
| 转牌 | Turn | 发出第4张公共牌 | 4 |
| 河牌 | River | 发出第5张公共牌 | 5 |
| 摊牌 | Showdown | 玩家比大小 | - |

### 1.2 牌型大小（从高到低）

1. **皇家同花顺** (Royal Flush)：A、K、Q、J、10 同花色
2. **同花顺** (Straight Flush)：五张同花色连续牌
3. **四条** (Four of a Kind)：四张相同点数的牌
4. **葫芦** (Full House)：三条+一对
5. **同花** (Flush)：五张同花色
6. **顺子** (Straight)：五张连续牌
7. **三条** (Three of a Kind)：三张相同点数
8. **两对** (Two Pair)：两个对子
9. **一对** (One Pair)：一个对子
10. **高牌** (High Card)：最大单张

### 1.3 位置系统

德州扑克中的位置非常重要，从左到右依次为：

- **UTG** (Under the Gun)：大盲注左边的位置，第一个行动
- **MP** (Middle Position)：中间位置
- **CO** (Cutoff)：庄家右边一位
- **BTN** (Button/Dealer)：庄家位，最后一个行动
- **SB** (Small Blind)：小盲位
- **BB** (Big Blind)：大盲位

位置越靠后，信息优势越大。

### 1.4 常见动作

| 动作 | 英文 | 说明 |
|------|------|------|
| 弃牌 | Fold | 放弃当前手牌 |
| 看牌 | Check | 不下注，跟进到下一轮 |
| 跟注 | Call | 跟随上家下注相同金额 |
| 下注 | Bet | 主动下注 |
| 加注 | Raise | 提高当前下注金额 |
| 全下 | All-in | 投入全部筹码 |

---

## 2. PokerNow 对局日志格式说明

### 2.1 CSV 文件结构

PokerNow 导出的日志文件为 CSV 格式，包含三列：

```csv
entry,at,order
```

| 列名 | 说明 |
|------|------|
| entry | 日志内容文本 |
| at | 时间戳 (ISO 8601 格式) |
| order | 事件排序编号 |

### 2.2 常见日志类型

#### 2.2.1 手牌开始/结束

```csv
"-- starting hand #266 (id: xrdzvysblawy)  No Limit Texas Hold'em (dealer: ""hyq @ HZkdinonr0"") --",2026-02-13T19:10:18.732Z,177100981873200
"-- ending hand #266 --",2026-02-13T19:11:42.246Z,177100990224602
```

- `starting hand` 包含：手牌编号、手牌ID、游戏类型、庄家位置
- `ending hand` 仅包含手牌编号

#### 2.2.2 玩家座位

```csv
"Player stacks: #1 ""wjh @ yQzNmdWzgU"" (889) | #2 ""hyq @ HZkdinonr0"" (1826) | #3 ""mouyu1021 @ UAV9Myl4l0"" (510) | #4 ""cy @ A4iDUuyzZu"" (734) | #10 ""lmm @ 0_1uK8q5GK"" (187)",2026-02-13T19:10:18.732Z,177100981873201
```

显示所有玩家的座位编号、昵称和当前筹码量。

#### 2.2.3 盲注

```csv
"""cy @ A4iDUuyzZu"" posts a big blind of 2",2026-02-13T19:10:18.732Z,177100981873208
"""mouyu1021 @ UAV9Myl4l0"" posts a small blind of 1",2026-02-13T19:10:18.732Z,177100981873207
```

- 大盲注 (Big Blind)：通常是最低下注额的2倍
- 小盲注 (Small Blind)：通常是最低下注额的1倍

#### 2.2.4 玩家底牌

```csv
"Your hand is 7♠, K♣",2026-02-13T19:10:18.732Z,177100981873202
```

每个玩家只能看到自己的两张底牌。

#### 2.2.5 玩家动作

```csv
"""cy @ A4iDUuyzZu"" folds",2026-02-13T19:10:26.804Z,177100982680400
"""wjh @ yQzNmdWzgU"" checks",2026-02-13T19:09:53.166Z,177100979316600
"""cy @ A4iDUuyzZu"" calls 7",2026-02-13T19:10:39.877Z,177100983987700
"""hyq @ HZkdinonr0"" raises to 7",2026-02-13T19:10:29.333Z,177100982933300
"""cy @ A4iDUuyzZu"" bets 20",2026-02-13T19:11:10.050Z,177100987005000
```

| 动作 | 日志格式 |
|------|----------|
| Fold | `"xxx" folds` |
| Check | `"xxx" checks` |
| Call | `"xxx" calls [金额]` |
| Raise | `"xxx" raises to [金额]` |
| Bet | `"xxx" bets [金额]` |

#### 2.2.6 公共牌

```csv
"Flop:  [J♦, 4♥, K♥]",2026-02-13T19:10:40.718Z,177100984071800
"Turn: J♦, 4♥, K♥ [Q♥]",2026-02-13T19:10:59.730Z,177100985973000
"Turn: K♥, Q♥, A♥ [8♦]",2026-02-13T19:09:53.971Z,177100979397100
```

- Flop：翻牌圈，3张公共牌
- Turn：转牌圈，第4张公共牌（用方括号标出）
- River：河牌圈，第5张公共牌

#### 2.2.7 摊牌与获胜

```csv
"""cy @ A4iDUuyzZu"" shows a J♥.",2026-02-13T19:11:45.622Z,177100990562200
"""wjh @ yQzNmdWzgU"" shows a 7♠, K♣.",2026-02-13T19:11:45.222Z,177100990522200
"""cy @ A4iDUuyzZu"" collected 45 from pot",2026-02-13T19:11:42.246Z,177100990224601
```

- `shows a X` 表示玩家亮出底牌
- `collected X from pot` 表示玩家赢得彩池

#### 2.2.8 未被跟注的注码

```csv
"Uncalled bet of 20 returned to ""cy @ A4iDUuyzZu""",2026-02-13T19:11:42.246Z,177100990224600
```

当玩家下注后无人跟注，未被跟注的金额会返还给下注者。

---

## 3. 如何分析对局日志

### 3.1 解析器功能 (parser.py)

解析器负责将原始 CSV 日志转换为结构化数据：

```python
# 解析日志文件
def parse_poker_log(file_path):
    # 读取 CSV 文件
    # 提取每条日志的类型和信息
    # 按手牌分组
    # 返回结构化数据
```

**解析步骤：**

1. 读取 CSV 文件，按 `order` 列排序
2. 识别日志类型（手牌开始、动作、公共牌等）
3. 提取关键信息：玩家昵称、动作类型、金额、时间戳
4. 按手牌编号分组，构建完整的手牌历史

### 3.2 统计分析引擎 (analyzer.py)

分析器基于解析后的数据计算玩家统计指标：

```python
# 分析玩家数据
def analyze_player(player_hand_history):
    # 计算各种统计指标
    # 返回玩家画像
```

### 3.3 关键统计指标

#### 3.3.1 VPIP (Voluntarily Put Money In Pot)

**主动投入率**，衡量玩家是否积极参与牌局。

```
VPIP = 主动投入筹码的手牌数 / 总手牌数
```

- 常用参考值：
  - 紧弱玩家：< 15%
  - 平衡玩家：20-30%
  - 松凶玩家：> 35%

#### 3.3.2 PFR (Pre-Flop Raise)

**翻牌前加注率**，衡量玩家在翻牌前主动加注的频率。

```
PFR = 翻牌前加注的手牌数 / 总手牌数
```

- 常用参考值：
  - 紧玩家：< 10%
  - 平衡玩家：15-25%
  - 松凶玩家：> 28%

#### 3.3.3 3-Bet

**3-Bet** 指翻牌前第三次下注（反加注）。

- 3-Bet 频率 = 3-Bet 次数 / 遇到加注的机会数
- 反映玩家的翻牌前攻击性

#### 3.3.4 C-Bet (Continuation Bet)

**持续下注**，指翻牌前加注后，在翻牌圈继续下注。

```
C-Bet 频率 = C-Bet 次数 / 翻牌前加注且看到翻牌的手牌数
```

- 常用参考值：50-70%

#### 3.3.5 WTSD (Went to Showdown)

**看到摊牌率**，指看到摊牌的手牌占比。

```
WTSD = 看到摊牌的手牌数 / 投入筹码的手牌数
```

- 常用参考值：
  - 紧玩家：< 20%
  - 松玩家：> 30%

#### 3.3.6 W$SD (Won Money at Showdown)

**摊牌胜率**，指在看到摊牌的情况下获胜的概率。

```
W$SD = 摊牌获胜次数 / 看到摊牌次数
```

- 反映玩家摊牌后的牌力判断能力

#### 3.3.7 AF (Aggression Factor)

**攻击性系数**，衡量玩家下注/加注与跟注的比例。

```
AF = (下注次数 + 加注次数) / (跟注次数)
```

- 常用参考值：
  - 被动玩家：< 1.0
  - 平衡玩家：1.0-2.5
  - 凶猛玩家：> 2.5

### 3.4 数据分析示例

基于日志分析，可以得到类似以下的玩家统计：

| 玩家 | 手牌数 | VPIP | PFR | 3-Bet | C-Bet | WTSD | W$SD | AF |
|------|--------|------|-----|-------|-------|------|------|-----|
| wjh  | 150    | 28%  | 22% | 8%    | 65%   | 24%  | 52%  | 1.8 |
| hyq  | 145    | 35%  | 18% | 5%    | 58%   | 31%  | 48%  | 1.2 |
| cy   | 138    | 22%  | 19% | 12%   | 72%   | 18%  | 61%  | 2.4 |

---

## 4. 总结

通过对 PokerNow 对局日志的解析和分析，可以：

1. **重建完整的手牌历史** - 还原每手牌的全部过程
2. **计算玩家统计指标** - 量化玩家的游戏风格和水平
3. **识别玩家类型** - 紧/松、被动/凶猛
4. **发现游戏漏洞** - 通过数据分析找出薄弱环节

这些分析结果可用于：
- 玩家对局复盘
- 游戏策略优化
- 玩家间对比评估
